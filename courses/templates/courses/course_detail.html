{% extends "base.html" %}

{% block content %}
    <h2>{{ course.name }}</h2>
    <p>{{ course.description }}</p>

    {% if request.user.user_type == "teacher" %}
        <!-- Link to create a new lesson for this course -->
        <a href="{% url 'teachers:create_lesson' course.id %}">Create New Lesson</a>

        <!-- Link to create a new quiz for this course -->
        <a href="{% url 'teachers:create_quiz' course.id %}">Create New Quiz</a>

        <!-- List existing lessons for this course -->
        <h3>Lessons</h3>
        <ul>
            {% for lesson in course.lesson_set.all %}
                <li>
                    <a href="{% url 'teachers:lesson_detail' lesson.id %}">{{ lesson.title }}</a>
                    <a href="{% url 'teachers:edit_lesson' lesson.id %}">Edit</a>
                    <a href="{% url 'teachers:delete_lesson' lesson.id %}">Delete</a>
                </li>
            {% endfor %}
        </ul>

        <!-- List existing quizzes for this course -->
        <h3>Quizzes</h3>
        <ul>
            {% for quiz in course.quizzes.all %}
                <li>
                    <a href="{% url 'teachers:quiz_detail' quiz.id %}">{{ quiz.title }}</a>
                    <a href="{% url 'teachers:edit_quiz' quiz.id %}">Edit</a>
                    <a href="{% url 'teachers:delete_quiz' quiz.id %}">Delete</a>
                </li>
            {% endfor %}
        </ul>

        <!-- Student Roster -->
        <h3>Student Roster</h3>
        <ul>
            {% for student in students %}
                <li>{{ student.username }} - {{ student.email }}</li>
            {% empty %}
                <li>No students enrolled.</li>
            {% endfor %}
        </ul>

        <!-- Gradebook -->
        <h3>Gradebook</h3>
<table style="width:100%; border-collapse: collapse;">
    <thead>
        <tr>
            <th style="width:5%;">Student</th>
            <th style="width:5%;">Assignment/Quiz</th>
            <th style="width:10%; text-align:right;">Grade</th>
            <th style="width:10%; text-align:right;">Attempt Number</th>
        </tr>
    </thead>
    <tbody>
        {% for grade in grades %}
            <tr>
                <td>{{ grade.student }}</td>
                <td>
                    {% if grade.quiz %}
                        Quiz: {{ grade.quiz.title }}
                    {% elif grade.assignment %}
                        Assignment: {{ grade.assignment.title }}
                    {% endif %}
                </td>
                <td style="text-align:right;">{{ grade.grade }}</td>
                <td style="text-align:right;">{{ grade.attempt_number }}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
        
    {% else %}
        <!-- For students, list the lessons they can view -->
        <h3>Lessons</h3>
        <ul>
            {% for lesson in course.lesson_set.all %}
                <li>
                    <a href="{% url 'students:lesson_detail' lesson.id %}">{{ lesson.title }}</a>
                </li>
            {% endfor %}
        </ul>

        <!-- For students, list the quizzes they can take -->
        <h3>Quizzes</h3>
        <ul>
            {% for quiz in course.quizzes.all %}
                <li>
                    <a href="{% url 'students:take_quiz' quiz.id %}">{{ quiz.title }}</a>
                </li>
            {% endfor %}
        </ul>

        <!-- Student Grades -->
        <h3>Your Grades</h3>
        <table>
            <thead>
                <tr>
                    <th>Assignment/Quiz</th>
                    <th>Grade</th>
                    <th>Attempt Number</th>
                </tr>
            </thead>
            <tbody>
                {% for grade in grades %}
                    <tr>
                        <td>
                            {% if grade.quiz %}
                                Quiz: {{ grade.quiz.title }}
                            {% else %}
                                Assignment: {{ grade.assignment.title }}
                            {% endif %}
                        </td>
                        <td>{{ grade.grade }}</td>
                        <td>{{ grade.attempt_number }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="3">No grades recorded.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}
